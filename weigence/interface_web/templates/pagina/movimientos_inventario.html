{% extends "base.html" %}
{% block title %}Movimientos - Weigence{% endblock %}

{% block top %}
  {% include "componentes/header.html" %}
{% endblock %}

{% block sidebar %}
  {% include "componentes/sidebar.html" %}
{% endblock %}

{% block contenido %}
<main class="flex-1 w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    
    <!-- TIMELINE MOVIMIENTOS -->
    <div class="lg:col-span-2 space-y-8">
      <div class="bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)] p-6 rounded-xl shadow-sm border border-neutral-300 dark:border-neutral-700">
        <h2 class="text-xl font-bold text-neutral-900 dark:text-neutral-100 mb-4 flex items-center gap-2">
          <span class="material-symbols-outlined text-primary-600 dark:text-primary-400">sync_alt</span>
          Movimientos en Tiempo Real
        </h2>

        <div id="timeline-container" class="relative pl-6 space-y-5">
          {% for movimiento in movimientos %}
          <div class="timeline-item group relative pb-3 cursor-grab active:cursor-grabbing transition-all duration-200 hover:-translate-y-0.5"
              data-index="{{ loop.index0 }}"
              draggable="true">
            
            <!-- Icono lateral -->
            <div class="absolute left-0 top-1 flex items-center justify-center rounded-full w-6 h-6 shadow-sm
              {% if movimiento.tipo_evento == 'Añadir' %}
                bg-green-100 text-green-600 dark:bg-green-900/50 dark:text-green-400
              {% elif movimiento.tipo_evento == 'Retirar' %}
                bg-red-100 text-red-600 dark:bg-red-900/50 dark:text-red-400
              {% else %}
                bg-blue-100 text-blue-600 dark:bg-blue-900/50 dark:text-blue-400
              {% endif %}">
              <span class="material-symbols-outlined text-base">
                {% if movimiento.tipo_evento == 'Añadir' %}arrow_downward
                {% elif movimiento.tipo_evento == 'Retirar' %}arrow_upward
                {% else %}arrow_forward{% endif %}
              </span>
            </div>

            <!-- Contenido movimiento -->
            <div class="ml-8 bg-neutral-100 dark:bg-neutral-800 rounded-lg p-3 border border-transparent group-hover:border-primary-400 dark:group-hover:border-primary-600 transition-all">
              <p class="text-sm font-semibold text-neutral-900 dark:text-neutral-100">
                {{ movimiento.tipo_evento }}: 
                <span class="font-bold text-primary-700 dark:text-primary-400">
                  {{ movimiento.cantidad }}kg
                </span> 
                de {{ movimiento.producto }}
              </p>
              <p class="text-xs text-neutral-500 dark:text-neutral-400 mt-1">
                {{ movimiento.timestamp }} | {{ movimiento.ubicacion }} | por 
                <span title="{{ movimiento.usuario_nombre or 'Sin nombre' }}"
                      class="font-mono font-semibold text-primary-700 dark:text-primary-400 cursor-help">
                  {{ movimiento.rut_usuario or "Desconocido" }}/{{ movimiento.usuario_nombre or "Desconocido" }}
                </span>
              </p>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- PANEL DETALLE CONTEXTUAL -->
    <div class="bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)] p-6 rounded-xl shadow-sm border border-neutral-300 dark:border-neutral-700">
      <h2 class="text-xl font-bold text-neutral-900 dark:text-neutral-100 mb-4 flex items-center gap-2">
        <span class="material-symbols-outlined text-primary-600 dark:text-primary-400">info</span>
        Detalles Contextuales
      </h2>

      <div id="detalle-contextual"
           class="text-center py-10 border-2 border-dashed border-neutral-300 dark:border-neutral-700 rounded-lg transition-all duration-300 ease-in-out
                  hover:border-primary-400 dark:hover:border-primary-600"
           ondragover="event.preventDefault()"
           ondrop="mostrarDetalleMovimiento(event)">
        <span class="material-symbols-outlined text-5xl text-neutral-400 dark:text-neutral-600">touch_app</span>
        <p class="mt-2 text-sm font-medium text-neutral-500 dark:text-neutral-400">Arrastra un movimiento para ver detalles</p>
        <p class="text-xs text-neutral-400 dark:text-neutral-500">Historial, usuarios y alertas aparecerán aquí.</p>
      </div>
    </div>

    <!-- Consola Avanzada y Centro de Alertas -->
    <div class="space-y-8">
      <div class="bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)] p-6 rounded-lg shadow-sm border border-neutral-300 dark:border-neutral-700">
        <h2 class="text-xl font-bold text-neutral-900 dark:text-neutral-100 mb-4">Consola de Auditoría</h2>
        <div class="space-y-4">
          <div class="relative">
            <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400 dark:text-neutral-500">search</span>
            <input class="w-full pl-10 pr-4 py-2 rounded-lg border border-neutral-300 dark:border-neutral-700 bg-neutral-100 dark:bg-neutral-800 focus:ring-2 focus:ring-primary focus:border-primary" placeholder="Buscar movimientos..." type="text"/>
          </div>
          <div class="flex flex-wrap gap-2">
            <button class="px-3 py-1 text-xs font-medium text-neutral-700 dark:text-neutral-300 bg-neutral-100 dark:bg-neutral-800 rounded-full hover:bg-neutral-200 dark:hover:bg-neutral-700">Producto</button>
            <button class="px-3 py-1 text-xs font-medium text-neutral-700 dark:text-neutral-300 bg-neutral-100 dark:bg-neutral-800 rounded-full hover:bg-neutral-200 dark:hover:bg-neutral-700">Estantería</button>
            <button class="px-3 py-1 text-xs font-medium text-neutral-700 dark:text-neutral-300 bg-neutral-100 dark:bg-neutral-800 rounded-full hover:bg-neutral-200 dark:hover:bg-neutral-700">Usuario</button>
            <button class="px-3 py-1 text-xs font-medium text-neutral-700 dark:text-neutral-300 bg-neutral-100 dark:bg-neutral-800 rounded-full hover:bg-neutral-200 dark:hover:bg-neutral-700">Operación</button>
          </div>
          <div>
            <select class="w-full px-4 py-2 rounded-lg border border-neutral-300 dark:border-neutral-700 bg-neutral-100 dark:bg-neutral-800 focus:ring-2 focus:ring-primary focus:border-primary">
              <option>Últimas 24 horas</option>
              <option>Últimos 7 días</option>
              <option>Últimos 30 días</option>
              <option>Rango personalizado</option>
            </select>
          </div>
          <button class="w-full flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-neutral-100 dark:bg-neutral-800 hover:bg-neutral-200 dark:hover:bg-neutral-700 text-sm font-medium text-neutral-700 dark:text-neutral-300 transition-colors">
            <span class="material-symbols-outlined text-base">download</span>
            Exportar
          </button>
        </div>
      </div>
      <div class="bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)] p-6 rounded-lg shadow-sm border border-neutral-300 dark:border-neutral-700">
        <h2 class="text-xl font-bold text-neutral-900 dark:text-neutral-100 mb-4">Centro Inteligente de Alertas</h2>
        <div class="space-y-4">
          <select class="w-full px-4 py-2 rounded-lg border border-neutral-300 dark:border-neutral-700 bg-neutral-100 dark:bg-neutral-800 focus:ring-2 focus:ring-primary focus:border-primary">
            <option>Selecciona tipo de alerta</option>
            <option>Cantidad inusual</option>
            <option>Fuera de horario laboral</option>
            <option>Usuario no autorizado</option>
          </select>
          <select class="w-full px-4 py-2 rounded-lg border border-neutral-300 dark:border-neutral-700 bg-neutral-100 dark:bg-neutral-800 focus:ring-2 focus:ring-primary focus:border-primary">
            <option>Selecciona notificación</option>
            <option>Banner en la app</option>
            <option>Correo electrónico</option>
            <option>Notificación push</option>
          </select>
          <button class="w-full flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-primary text-white text-sm font-medium hover:bg-primary/90 transition-colors">
            <span class="material-symbols-outlined text-base">add_alert</span>
            Agregar regla de alerta
          </button>
        </div>
        <div class="mt-6">
          <h3 class="text-sm font-semibold text-neutral-600 dark:text-neutral-400 mb-3">Reglas sugeridas</h3>
          <div class="space-y-3">
            <label class="flex items-center gap-3 text-sm text-neutral-700 dark:text-neutral-300">
              <input class="h-4 w-4 rounded border-neutral-300 dark:border-neutral-600 text-primary focus:ring-primary bg-neutral-100 dark:bg-neutral-800" type="checkbox"/>
              Alertar por movimientos fuera de 9:00 a 18:00.
            </label>
            <label class="flex items-center gap-3 text-sm text-neutral-700 dark:text-neutral-300">
              <input class="h-4 w-4 rounded border-neutral-300 dark:border-neutral-600 text-primary focus:ring-primary bg-neutral-100 dark:bg-neutral-800" type="checkbox"/>
              Notificar por cambios de peso &gt; 20%.
            </label>
            <label class="flex items-center gap-3 text-sm text-neutral-700 dark:text-neutral-300">
              <input class="h-4 w-4 rounded border-neutral-300 dark:border-neutral-600 text-primary focus:ring-primary bg-neutral-100 dark:bg-neutral-800" type="checkbox"/>
              Alertar por actividad en fin de semana.
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>


{% endblock %}
