{% extends "base.html" %}
{% block title %}Ventas - Weigence{% endblock %}

{% block top %}
{% include "componentes/header.html" %}
{% endblock %}

{% block sidebar %}
{% include "componentes/sidebar.html" %}
{% endblock %}

{% block contenido %}

<h2 class="text-3xl font-bold mb-8 text-left">Ventas</h2>

<!-- Tarjetas de resumen -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
  <div
    class="bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)] border border-neutral-300 dark:border-[var(--border-dark)] p-6 rounded-xl shadow-sm flex items-center gap-4">
    <div class="p-3 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-500 dark:text-blue-400">
      <span class="material-symbols-outlined">shopping_cart</span>
    </div>
    <div>
      <p class="text-slate-500 dark:text-slate-400 text-sm">Ventas Totales</p>
      <p class="text-2xl font-bold text-slate-900 dark:text-slate-100">
        ${{ total_ventas_str }}
      </p>
    </div>
  </div>
  <div
    class="bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)] border border-neutral-300 dark:border-[var(--border-dark)] p-6 rounded-xl shadow-sm flex items-center gap-4">
    <div class="p-3 rounded-full bg-green-100 dark:bg-green-900 text-green-500 dark:text-green-400">
      <span class="material-symbols-outlined">attach_money</span>
    </div>
    <div>
      <p class="text-slate-500 dark:text-slate-400 text-sm">Valor Promedio por Venta</p>
      <p class="text-2xl font-bold text-slate-900 dark:text-slate-100">
        ${{ promedio_ventas_str }}
      </p>
    </div>
  </div>
  <div
    class="bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)] border border-neutral-300 dark:border-[var(--border-dark)] p-6 rounded-xl shadow-sm flex items-center gap-4">
    <div class="p-3 rounded-full bg-yellow-100 dark:bg-yellow-900 text-yellow-500 dark:text-yellow-400">
      <span class="material-symbols-outlined">receipt_long</span>
    </div>
    <div>
      <p class="text-slate-500 dark:text-slate-400 text-sm">Número de Transacciones</p>
      <p class="text-2xl font-bold text-slate-900 dark:text-slate-100">{{ num_transacciones }}</p>
    </div>
  </div>
  <div
    class="bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)] border border-neutral-300 dark:border-[var(--border-dark)] p-6 rounded-xl shadow-sm flex items-center gap-4">
    <div class="p-3 rounded-full bg-purple-100 dark:bg-purple-900 text-purple-500 dark:text-purple-400">
      <span class="material-symbols-outlined">star</span>
    </div>
    <div>
      <p class="text-slate-500 dark:text-slate-400 text-sm">Producto Más Vendido</p>
      <p class="text-2xl font-bold text-slate-900 dark:text-slate-100">
        {{ top_producto_str }}
      </p>
    </div>
  </div>
</div>
<!-- Tabla de ventas recientes -->

      <!-- Botón de filtros -->
      <div class="mb-6">
        <button id="toggleFiltrosBtn" class="flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg border border-neutral-300 dark:border-neutral-700 bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)] text-neutral-900 dark:text-neutral-100 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors">
          <span class="material-symbols-outlined text-base">filter_alt</span>
          <span>Filtros</span>
          <span id="filtrosChevron" class="material-symbols-outlined text-base transition-transform">expand_more</span>
        </button>
      </div>

      <!-- Panel de Filtros (Colapsable) -->
      <div id="panelFiltros" class="hidden bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)] rounded-xl border border-neutral-300 dark:border-[var(--border-dark)] shadow-sm p-4 sm:p-6 mb-6 transition-all duration-300">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-3">
            <div class="p-2 rounded-lg bg-blue-100 dark:bg-blue-900/30">
              <span class="material-symbols-outlined text-blue-600 dark:text-blue-400">filter_alt</span>
            </div>
            <div>
              <h3 class="text-base sm:text-lg font-semibold text-neutral-900 dark:text-neutral-100">Filtros de Búsqueda</h3>
              <p class="text-xs sm:text-sm text-neutral-600 dark:text-neutral-400">Refina los resultados según tus criterios</p>
            </div>
          </div>
          <button id="btn-limpiar-filtros" class="flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-lg bg-neutral-200 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-200 hover:bg-neutral-300 dark:hover:bg-neutral-600 transition-all shadow">
            <span class="material-symbols-outlined text-sm">restart_alt</span>
            <span class="text-xs sm:text-sm font-medium hidden sm:inline">Limpiar filtros</span>
          </button>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
          <!-- Filtro por Producto -->
          <div>
            <label class="block text-xs sm:text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1.5 sm:mb-2">
              <span class="flex items-center gap-2">
                <span class="material-symbols-outlined text-sm">inventory_2</span>
                Producto
              </span>
            </label>
            <select id="filtro-producto" class="w-full px-2.5 sm:px-3 py-2 text-xs sm:text-sm rounded-lg bg-neutral-100 dark:bg-neutral-800 border border-neutral-300 dark:border-[var(--border-dark)] text-neutral-900 dark:text-neutral-100 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-colors">
              <option value="">Todos los productos</option>
              {% for id, nombre in productos_dict.items() %}
              <option value="{{ id }}">{{ nombre }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Filtro por Vendedor -->
          <div>
            <label class="block text-xs sm:text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1.5 sm:mb-2">
              <span class="flex items-center gap-2">
                <span class="material-symbols-outlined text-sm">person</span>
                Vendedor
              </span>
            </label>
            <select id="filtro-vendedor" class="w-full px-2.5 sm:px-3 py-2 text-xs sm:text-sm rounded-lg bg-neutral-100 dark:bg-neutral-800 border border-neutral-300 dark:border-[var(--border-dark)] text-neutral-900 dark:text-neutral-100 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-colors">
              <option value="">Todos los vendedores</option>
              {% for rut, nombre in usuarios_dict.items() %}
              <option value="{{ rut }}">{{ nombre }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Filtro por Rango de Fecha -->
          <div>
            <label class="block text-xs sm:text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1.5 sm:mb-2">
              <span class="flex items-center gap-2">
                <span class="material-symbols-outlined text-sm">calendar_today</span>
                Fecha desde
              </span>
            </label>
            <input type="date" id="filtro-fecha-desde" class="w-full px-2.5 sm:px-3 py-2 text-xs sm:text-sm rounded-lg bg-neutral-100 dark:bg-neutral-800 border border-neutral-300 dark:border-[var(--border-dark)] text-neutral-900 dark:text-neutral-100 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-colors">
          </div>

          <div>
            <label class="block text-xs sm:text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1.5 sm:mb-2">
              <span class="flex items-center gap-2">
                <span class="material-symbols-outlined text-sm">calendar_today</span>
                Fecha hasta
              </span>
            </label>
            <input type="date" id="filtro-fecha-hasta" class="w-full px-2.5 sm:px-3 py-2 text-xs sm:text-sm rounded-lg bg-neutral-100 dark:bg-neutral-800 border border-neutral-300 dark:border-[var(--border-dark)] text-neutral-900 dark:text-neutral-100 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-colors">
          </div>

          <!-- Filtro por Rango de Total -->
          <div>
            <label class="block text-xs sm:text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1.5 sm:mb-2">
              <span class="flex items-center gap-2">
                <span class="material-symbols-outlined text-sm">attach_money</span>
                Total mínimo
              </span>
            </label>
            <input type="number" id="filtro-total-min" placeholder="$0" class="w-full px-2.5 sm:px-3 py-2 text-xs sm:text-sm rounded-lg bg-neutral-100 dark:bg-neutral-800 border border-neutral-300 dark:border-[var(--border-dark)] text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-500 dark:placeholder:text-neutral-500 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-colors">
          </div>

          <div>
            <label class="block text-xs sm:text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1.5 sm:mb-2">
              <span class="flex items-center gap-2">
                <span class="material-symbols-outlined text-sm">attach_money</span>
                Total máximo
              </span>
            </label>
            <input type="number" id="filtro-total-max" placeholder="Sin límite" class="w-full px-2.5 sm:px-3 py-2 text-xs sm:text-sm rounded-lg bg-neutral-100 dark:bg-neutral-800 border border-neutral-300 dark:border-[var(--border-dark)] text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-500 dark:placeholder:text-neutral-500 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-colors">
          </div>

          <!-- Botón Aplicar Filtros -->
          <div class="lg:col-span-2 flex items-end">
            <button id="btn-aplicar-filtros" class="w-full flex items-center justify-center gap-2 px-3 sm:px-4 py-2 text-xs sm:text-sm rounded-lg bg-neutral-200 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-200 font-semibold hover:bg-neutral-300 dark:hover:bg-neutral-600 transition-all shadow">
              <span class="material-symbols-outlined text-base">search</span>
              <span>Aplicar Filtros</span>
            </button>
          </div>
        </div>

        <!-- Resumen de Filtros Activos -->
        <div id="filtros-activos" class="mt-3 sm:mt-4 hidden">
          <div class="flex items-center gap-2 flex-wrap">
            <span class="text-xs sm:text-sm font-medium text-neutral-700 dark:text-neutral-300">Filtros activos:</span>
            <div id="filtros-activos-chips" class="flex items-center gap-2 flex-wrap"></div>
          </div>
        </div>
      </div>

      <!-- Resumen de filtros activos fuera del panel -->
      <div id="filtros-activos-resumen" class="hidden bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3 mb-4">
        <div class="flex items-center gap-2 flex-wrap">
          <span class="material-symbols-outlined text-blue-600 dark:text-blue-400 text-sm">info</span>
          <span class="text-xs sm:text-sm font-medium text-blue-900 dark:text-blue-200">Filtros aplicados:</span>
          <div id="filtros-activos-chips-resumen" class="flex items-center gap-2 flex-wrap"></div>
        </div>
      </div>

      <!-- Tabla de ventas (diseño mejorado) -->
      <div class="bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)] rounded-xl border border-neutral-300 dark:border-[var(--border-dark)] shadow-sm overflow-hidden">
        <!-- Header de la tabla -->
        <div class="px-6 py-4 border-b border-neutral-300 dark:border-[var(--border-dark)] bg-neutral-100 dark:bg-neutral-800/50">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="p-2 rounded-lg bg-primary-100 dark:bg-primary-900/30">
                <span class="material-symbols-outlined text-primary-600 dark:text-primary-400">receipt_long</span>
              </div>
              <div>
                <h3 class="text-lg font-semibold text-neutral-900 dark:text-neutral-100">Historial de Ventas</h3>
                <p class="text-sm text-neutral-600 dark:text-neutral-400">Registro completo de transacciones</p>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <span id="ventas-counter" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200">
                <span class="w-2 h-2 rounded-full bg-green-600 dark:bg-green-400 mr-2 animate-pulse"></span>
                {{ ventas|length }} ventas
              </span>
              <!-- El widget de filtro activo se insertará aquí dinámicamente por JavaScript -->
            </div>
          </div>
        </div>

        <!-- Tabla con scroll -->
        <div class="max-h-[60vh] overflow-auto">
          <table id="ventasTable" class="w-full text-sm">
            <thead class="sticky top-0 z-10 bg-neutral-200 dark:bg-neutral-800 border-b-2 border-neutral-300 dark:border-[var(--border-dark)]">
              <tr>
                <th class="px-6 py-4 text-left">
                  <div class="flex items-center gap-2 font-semibold text-neutral-700 dark:text-neutral-300 uppercase text-xs tracking-wider">
                    <span class="material-symbols-outlined text-base">tag</span>
                    ID Venta
                  </div>
                </th>
                <th class="px-6 py-4 text-left">
                  <div class="flex items-center gap-2 font-semibold text-neutral-700 dark:text-neutral-300 uppercase text-xs tracking-wider">
                    <span class="material-symbols-outlined text-base">calendar_today</span>
                    Fecha
                  </div>
                </th>
                <th class="px-6 py-4 text-left">
                  <div class="flex items-center gap-2 font-semibold text-neutral-700 dark:text-neutral-300 uppercase text-xs tracking-wider">
                    <span class="material-symbols-outlined text-base">person</span>
                    Vendedor
                  </div>
                </th>
                <th class="px-6 py-4 text-left">
                  <div class="flex items-center gap-2 font-semibold text-neutral-700 dark:text-neutral-300 uppercase text-xs tracking-wider">
                    <span class="material-symbols-outlined text-base">payments</span>
                    Total
                  </div>
                </th>
                <th class="px-6 py-4 text-center">
                  <div class="flex items-center justify-center gap-2 font-semibold text-neutral-700 dark:text-neutral-300 uppercase text-xs tracking-wider">
                    <span class="material-symbols-outlined text-base">info</span>
                    Acciones
                  </div>
                </th>
              </tr>
            </thead>
            <tbody class="divide-y divide-neutral-200 dark:divide-neutral-700 bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)]">
              {% for venta in ventas %}
              {% set detalles = detalle_ventas | selectattr('idventa', 'equalto', venta.idventa) | list %}
              {% set nombre_vendedor = usuarios_dict.get(venta.rut_usuario, 'Usuario Desconocido') %}
              <tr class="hover:bg-neutral-50 dark:hover:bg-neutral-800/50 transition-all duration-200 venta-row group"
                  data-idventa="{{ venta.idventa }}"
                  data-fecha="{{ venta.fecha_venta }}"
                  data-vendedor-rut="{{ venta.rut_usuario }}"
                  data-vendedor-nombre="{{ nombre_vendedor }}"
                  data-total="{{ venta.total }}"
                  data-detalles='{{ detalles | tojson }}'
                  data-productos='{{ productos_dict | tojson }}'>
                
                <!-- ID Venta -->
                <td class="px-6 py-4">
                  <div class="flex items-center gap-3">
                    <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center">
                      <span class="material-symbols-outlined text-primary-600 dark:text-primary-400 text-xl">shopping_bag</span>
                    </div>
                    <div>
                      <span class="font-bold text-neutral-900 dark:text-neutral-100">#{{ venta.idventa }}</span>
                      <p class="text-xs text-neutral-500 dark:text-neutral-400">{{ detalles|length }} producto{{ 's' if detalles|length != 1 else '' }}</p>
                    </div>
                  </div>
                </td>

                <!-- Fecha -->
                <td class="px-6 py-4">
                  <div class="flex flex-col">
                    <span class="font-medium text-neutral-900 dark:text-neutral-100">
                      {{ venta.fecha_venta.split('T')[0] if 'T' in venta.fecha_venta else venta.fecha_venta.split(' ')[0] }}
                    </span>
                    <span class="text-xs text-neutral-500 dark:text-neutral-400">
                      {% if 'T' in venta.fecha_venta %}
                        {{ venta.fecha_venta.split('T')[1].split('.')[0] if '.' in venta.fecha_venta else venta.fecha_venta.split('T')[1] }}
                      {% elif ' ' in venta.fecha_venta and venta.fecha_venta.split(' ')|length > 1 %}
                        {{ venta.fecha_venta.split(' ')[1] }}
                      {% else %}
                        --:--:--
                      {% endif %}
                    </span>
                  </div>
                </td>

                <!-- Vendedor -->
                <td class="px-6 py-4">
                  <div class="flex items-center gap-3">
                    <div class="flex-shrink-0 w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                      <span class="material-symbols-outlined text-blue-600 dark:text-blue-400 text-sm">person</span>
                    </div>
                    <div>
                      <span class="font-semibold text-neutral-900 dark:text-neutral-100 block">{{ nombre_vendedor }}</span>
                      <span class="text-xs text-neutral-500 dark:text-neutral-400">{{ venta.rut_usuario }}</span>
                    </div>
                  </div>
                </td>

                <!-- Total -->
                <td class="px-6 py-4">
                  <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800">
                    <span class="material-symbols-outlined text-green-600 dark:text-green-400 text-sm">attach_money</span>
                    <span class="font-bold text-green-900 dark:text-green-100">${{ "{:,.0f}".format(venta.total).replace(",", ".") }}</span>
                  </div>
                </td>

                <!-- Acciones -->
                <td class="px-6 py-4 text-center">
                  <button 
                    class="btn-ver-detalle inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-neutral-200 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-200 hover:bg-neutral-300 dark:hover:bg-neutral-600 text-sm font-medium transition-all duration-200 shadow"
                    data-idventa="{{ venta.idventa }}">
                    <span class="material-symbols-outlined text-base">visibility</span>
                    <span>Ver detalles</span>
                  </button>
                </td>
              </tr>
              {% else %}
              <tr id="noVentasRow">
                <td colspan="5" class="px-6 py-12 text-center">
                  <div class="flex flex-col items-center justify-center gap-3">
                    <div class="p-4 rounded-full bg-neutral-100 dark:bg-neutral-800">
                      <span class="material-symbols-outlined text-5xl text-neutral-400">receipt_long</span>
                    </div>
                    <p class="text-neutral-600 dark:text-neutral-400 font-medium">No hay ventas registradas</p>
                    <p class="text-sm text-neutral-500 dark:text-neutral-500">Las ventas aparecerán aquí cuando se registren</p>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

  <!-- Controles de paginación mejorados -->
  <div id="ventasPager"
      class="flex flex-wrap items-center justify-between gap-4 py-4 px-6 bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)] border border-neutral-300 dark:border-[var(--border-dark)] rounded-xl mt-4 shadow-sm">
    <div class="flex items-center gap-3">
      <span class="material-symbols-outlined text-neutral-600 dark:text-neutral-400">table_rows</span>
      <span class="text-sm font-medium text-neutral-700 dark:text-neutral-300">Filas por página:</span>
      <select id="ventasPageSize" class="h-10 px-3 rounded-lg bg-neutral-100 dark:bg-neutral-800 border border-neutral-300 dark:border-[var(--border-dark)] text-neutral-900 dark:text-neutral-100 font-medium shadow-sm hover:border-primary-500 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-colors">
        <option>10</option><option>25</option><option>50</option><option>100</option>
      </select>
    </div>
    <div class="flex items-center gap-2 text-sm font-medium text-neutral-700 dark:text-neutral-300 bg-neutral-100 dark:bg-neutral-800 px-4 py-2 rounded-lg">
      <span class="material-symbols-outlined text-base">description</span>
      <span id="ventasPageStats">0–0 de 0</span>
    </div>
    <div class="flex items-center gap-2">
      <button id="ventasPrevPage" class="h-10 px-4 border border-neutral-300 dark:border-[var(--border-dark)] rounded-lg text-neutral-700 dark:text-neutral-300 hover:bg-primary-50 dark:hover:bg-primary-900/20 hover:border-primary-500 dark:hover:border-primary-500 hover:text-primary-600 dark:hover:text-primary-400 transition-all duration-200 font-medium shadow-sm disabled:opacity-50 disabled:cursor-not-allowed" aria-label="Anterior">
        <span class="flex items-center gap-1">
          <span class="material-symbols-outlined text-base">chevron_left</span>
          <span class="hidden sm:inline">Anterior</span>
        </span>
      </button>
      <button id="ventasNextPage" class="h-10 px-4 border border-neutral-300 dark:border-[var(--border-dark)] rounded-lg text-neutral-700 dark:text-neutral-300 hover:bg-primary-50 dark:hover:bg-primary-900/20 hover:border-primary-500 dark:hover:border-primary-500 hover:text-primary-600 dark:hover:text-primary-400 transition-all duration-200 font-medium shadow-sm disabled:opacity-50 disabled:cursor-not-allowed" aria-label="Siguiente">
        <span class="flex items-center gap-1">
          <span class="hidden sm:inline">Siguiente</span>
          <span class="material-symbols-outlined text-base">chevron_right</span>
        </span>
      </button>
    </div>
  </div>

  <!-- Botones de acción mejorados -->
  <div class="flex flex-wrap gap-3 mt-6">
    <button
      id="btn-crear-venta"
      type="button"
      class="flex items-center gap-2 rounded-lg bg-neutral-200 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-200 px-5 py-3 text-sm font-semibold shadow hover:bg-neutral-300 dark:hover:bg-neutral-600 transition-all duration-200">
      <span class="material-symbols-outlined">add_circle</span>
      <span>Crear nueva venta</span>
    </button>
    <button
      id="btn-exportar-reporte"
      class="flex items-center gap-2 rounded-lg bg-neutral-200 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-200 px-5 py-3 text-sm font-semibold shadow hover:bg-neutral-300 dark:hover:bg-neutral-600 transition-all duration-200">
      <span class="material-symbols-outlined">download</span>
      <span>Exportar reporte</span>
    </button>
  </div>

  <!-- Modal de Detalle de Venta -->
  <div id="detalleVentaModal" class="hidden modal-overlay">
    <div class="absolute inset-0" onclick="Ventas.cerrarModal()"></div>
    <div class="modal-container w-full max-w-5xl
                bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)]
                border border-gray-300 dark:border-neutral-700
                rounded-2xl shadow-2xl">
      <div id="modalDetalleContent" class="p-6">
        <!-- El contenido se carga dinámicamente con JavaScript -->
      </div>
    </div>
  </div>

  <!-- Modal de Nueva Venta -->
  <div id="modal-nueva-venta" class="hidden modal-overlay">
    <div class="modal-container w-full max-w-3xl bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)] border border-gray-300 dark:border-neutral-700 rounded-2xl shadow-2xl" onclick="event.stopPropagation()">
      <div class="p-6">
        <!-- Header del Modal -->
        <div class="flex items-center justify-between mb-6 pb-4 border-b border-gray-300 dark:border-neutral-700">
          <div class="flex items-center gap-3">
            <div class="p-3 rounded-xl bg-gradient-to-br from-primary-500 to-primary-600">
              <span class="material-symbols-outlined text-3xl text-white">add_shopping_cart</span>
            </div>
            <div>
              <h2 class="text-2xl font-bold text-neutral-900 dark:text-neutral-100">Nueva Venta</h2>
              <p class="text-sm text-neutral-600 dark:text-neutral-400">Registrar una nueva transacción de venta</p>
            </div>
          </div>
          <button class="close-modal-venta p-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors">
            <span class="material-symbols-outlined text-neutral-600 dark:text-neutral-400">close</span>
          </button>
        </div>

        <!-- Formulario -->
        <form id="form-nueva-venta" class="space-y-6">
          <!-- Agregar Producto -->
          <div class="bg-neutral-50 dark:bg-neutral-800/50 rounded-lg p-4 border border-gray-300 dark:border-neutral-700">
            <h3 class="text-lg font-semibold text-neutral-900 dark:text-neutral-100 mb-4 flex items-center gap-2">
              <span class="material-symbols-outlined text-primary-600 dark:text-primary-400">inventory_2</span>
              Agregar Productos
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2">
                  Producto
                </label>
                <select id="producto-select" 
                        class="w-full h-11 px-3 rounded-lg bg-white dark:bg-neutral-900 border border-gray-300 dark:border-neutral-700 text-neutral-900 dark:text-neutral-100 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-colors">
                  <option value="">Seleccione un producto</option>
                </select>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2">
                  Cantidad
                </label>
                <input type="number" 
                       id="cantidad-producto" 
                       min="1" 
                       value="1"
                       class="w-full h-11 px-3 rounded-lg bg-white dark:bg-neutral-900 border border-gray-300 dark:border-neutral-700 text-neutral-900 dark:text-neutral-100 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 transition-colors">
              </div>
            </div>

            <button type="button" 
                    id="btn-agregar-producto"
                    class="mt-3 w-full flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg bg-primary-500 hover:bg-primary-600 text-white font-medium transition-colors">
              <span class="material-symbols-outlined">add</span>
              Agregar Producto
            </button>
          </div>

          <!-- Lista de Productos -->
          <div>
            <h3 class="text-lg font-semibold text-neutral-900 dark:text-neutral-100 mb-3 flex items-center gap-2">
              <span class="material-symbols-outlined text-primary-600 dark:text-primary-400">shopping_cart</span>
              Productos en la Venta
            </h3>
            <div id="productos-venta-list" class="space-y-2 min-h-[120px] max-h-[300px] overflow-y-auto p-3 bg-neutral-50 dark:bg-neutral-800/50 rounded-lg border border-gray-300 dark:border-neutral-700">
              <div class="text-center py-8 text-neutral-500 dark:text-neutral-400">
                <span class="material-symbols-outlined text-5xl mb-2">shopping_cart</span>
                <p>No hay productos agregados</p>
              </div>
            </div>
          </div>

          <!-- Total -->
          <div class="bg-gradient-to-r from-primary-500 to-primary-600 rounded-xl p-5 text-white">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="p-2 rounded-lg bg-white/20">
                  <span class="material-symbols-outlined text-2xl">paid</span>
                </div>
                <div>
                  <p class="text-sm font-medium opacity-90">Total de la Venta</p>
                  <p id="total-venta" class="text-3xl font-bold">$0</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Botones de Acción -->
          <div class="flex gap-3 pt-4 border-t border-gray-300 dark:border-neutral-700">
            <button type="button" 
                    class="close-modal-venta flex-1 px-4 py-3 rounded-lg border-2 border-gray-300 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300 font-semibold hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors">
              Cancelar
            </button>
            <button type="submit" 
                    class="flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg bg-gradient-to-r from-green-500 to-green-600 text-white font-semibold hover:from-green-600 hover:to-green-700 transition-all shadow-md hover:shadow-lg">
              <span class="material-symbols-outlined">check_circle</span>
              Registrar Venta
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/ventas.js') }}"></script>
{% endblock %}