{% extends "base.html" %}
{% block title %}Chat - Weigence{% endblock %}

{% block top %}
  {% include "componentes/header.html" %}
{% endblock %}
{% block sidebar %}
  {% include "componentes/sidebar.html" %}
{% endblock %}

{% block contenido %}
<div class="flex h-[calc(100vh-4rem)] bg-[var(--bg-light)] dark:bg-[var(--bg-dark)]">
  
  <!-- Panel izquierdo: Lista de conversaciones -->
  <aside class="w-full sm:w-80 lg:w-96 border-r border-gray-300 dark:border-neutral-700 bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)] flex flex-col">
    
    <!-- Header del panel -->
    <div class="p-4 border-b border-gray-300 dark:border-neutral-700">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-bold text-neutral-900 dark:text-neutral-100">Mensajes</h2>
        <button id="btn-nuevo-chat" class="p-2 rounded-lg bg-[var(--primary-color)] text-white hover:bg-[var(--primary-600)] transition-colors">
          <span class="material-symbols-outlined text-xl">edit_square</span>
        </button>
      </div>
      
      <!-- Búsqueda -->
      <div class="relative">
        <input 
          type="text" 
          id="buscar-conversacion" 
          placeholder="Buscar conversación..."
          class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-neutral-700 bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)]"
        >
        <span class="material-symbols-outlined absolute left-3 top-2.5 text-neutral-400 text-xl">search</span>
      </div>
    </div>
    
    <!-- Lista de conversaciones -->
    <div id="lista-conversaciones" class="flex-1 overflow-y-auto">
      <!-- Se llena dinámicamente -->
    </div>
  </aside>
  
  <!-- Panel derecho: Conversación activa -->
  <main class="flex-1 flex flex-col">
    
    <!-- Estado inicial: sin conversación seleccionada -->
    <div id="sin-conversacion" class="flex-1 flex items-center justify-center text-neutral-500 dark:text-neutral-400">
      <div class="text-center">
        <span class="material-symbols-outlined text-6xl mb-4 opacity-50">chat_bubble_outline</span>
        <p class="text-lg">Selecciona una conversación para comenzar</p>
      </div>
    </div>
    
    <!-- Área de conversación -->
    <div id="area-conversacion" class="hidden flex-1 flex flex-col">
      
      <!-- Header de conversación -->
      <header class="p-4 border-b border-gray-300 dark:border-neutral-700 bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)]">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-[var(--primary-color)] flex items-center justify-center text-white font-bold">
              <span id="chat-avatar"></span>
            </div>
            <div>
              <h3 id="chat-nombre" class="font-semibold text-neutral-900 dark:text-neutral-100"></h3>
              <p id="chat-info" class="text-xs text-neutral-500 dark:text-neutral-400"></p>
            </div>
          </div>
          <button class="p-2 rounded-lg hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors">
            <span class="material-symbols-outlined text-neutral-600 dark:text-neutral-400">more_vert</span>
          </button>
        </div>
      </header>
      
      <!-- Mensajes -->
      <div id="mensajes-contenedor" class="flex-1 overflow-y-auto p-4 space-y-3">
        <!-- Los mensajes se cargan aquí -->
      </div>
      
      <!-- Input de mensaje -->
      <footer class="p-4 border-t border-gray-300 dark:border-neutral-700 bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)]">
        <form id="form-enviar-mensaje" class="flex gap-2">
          <input 
            type="text" 
            id="input-mensaje" 
            placeholder="Escribe un mensaje..."
            class="flex-1 px-4 py-2 rounded-lg border border-gray-300 dark:border-neutral-700 bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)]"
            autocomplete="off"
          >
          <button 
            type="submit" 
            class="px-4 py-2 rounded-lg bg-[var(--primary-color)] text-white hover:bg-[var(--primary-600)] transition-colors font-medium"
          >
            <span class="material-symbols-outlined">send</span>
          </button>
        </form>
      </footer>
    </div>
  </main>
</div>

<!-- Modal: Nuevo Chat -->
<div id="modal-nuevo-chat" class="fixed inset-0 z-[100] hidden">
  <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" id="modal-backdrop"></div>
  <div class="relative mx-auto my-8 w-11/12 sm:w-3/4 md:w-2/3 lg:w-1/2 max-h-[85vh] overflow-y-auto
              bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)]
              border border-gray-300 dark:border-neutral-700
              rounded-xl shadow-2xl">
    <div class="p-6">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold text-neutral-900 dark:text-neutral-100">Nuevo Chat</h3>
        <button id="cerrar-modal" class="btn-cerrar inline-flex items-center justify-center h-9 w-9 rounded-md
                      text-neutral-600 dark:text-neutral-400
                      hover:bg-neutral-200 dark:hover:bg-neutral-700">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      
      <!-- Búsqueda de usuarios -->
      <div class="mb-4">
        <input 
          type="text" 
          id="buscar-usuario" 
          placeholder="Buscar usuario..."
          class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-neutral-700 bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-[var(--primary-color)]"
        >
      </div>
      
      <!-- Lista de usuarios -->
      <div id="lista-usuarios" class="space-y-2 max-h-96 overflow-y-auto">
        <!-- Se llena dinámicamente -->
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}
