{% extends "base.html" %}
{% block title %}Auditoría Inteligente - Weigence{% endblock %}

{% block top %}{% include "componentes/header.html" %}{% endblock %}
{% block sidebar %}{% include "componentes/sidebar.html" %}{% endblock %}

{% block contenido %}

<style>
/* Estilos modernos para la terminal de auditoría */
#audit-log-stream::-webkit-scrollbar {
  width: 8px;
}

#audit-log-stream::-webkit-scrollbar-track {
  background: #000000;
  border-radius: 0px;
}

#audit-log-stream::-webkit-scrollbar-thumb {
  background: #00ff00;
  border-radius: 0px;
  border: none;
}

#audit-log-stream::-webkit-scrollbar-thumb:hover {
  background: #00ff88;
}

.log-entry {
  animation: fadeInLog 0.3s ease-out;
}

@keyframes fadeInLog {
  from {
    opacity: 0;
    transform: translateX(-10px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* Estilos modernos para la terminal de auditoría */
#audit-log-stream::-webkit-scrollbar {
  width: 10px;
}

#audit-log-stream::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.3);
  border-radius: 5px;
}

#audit-log-stream::-webkit-scrollbar-thumb {
  background: rgba(59, 130, 246, 0.4);
  border-radius: 5px;
  border: 2px solid rgba(0, 0, 0, 0.3);
}

#audit-log-stream::-webkit-scrollbar-thumb:hover {
  background: rgba(59, 130, 246, 0.7);
}

.log-entry {
  animation: fadeInLog 0.3s ease-out;
}

@keyframes fadeInLog {
  from {
    opacity: 0;
    transform: translateX(-10px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* Resaltado de usuarios - estilo badge con fuente monospace */
.user-highlight {
  background: rgba(59, 130, 246, 0.12);
  color: #3b82f6;
  border: 1.5px solid rgba(59, 130, 246, 0.35);
  padding: 3px 9px;
  border-radius: 5px;
  font-size: 12px;
  font-weight: 700;
  font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
  letter-spacing: -0.1px;
  display: inline-block;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.dark .user-highlight {
  background: rgba(59, 130, 246, 0.18);
  color: #60a5fa;
  border-color: rgba(59, 130, 246, 0.4);
}

.log-entry:hover .user-highlight {
  background: rgba(59, 130, 246, 0.2);
  border-color: rgba(59, 130, 246, 0.5);
  transform: scale(1.03);
}

.dark .log-entry:hover .user-highlight {
  background: rgba(59, 130, 246, 0.25);
  color: #93c5fd;
}

/* Efectos de hover mejorados */
.log-entry {
  position: relative;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.log-entry::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: inherit;
  transition: width 0.2s ease;
}

.log-entry:hover::before {
  width: 5px;
}

.log-entry:hover {
  transform: translateX(2px) scale(1.01);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
}

/* Efecto de pulsación para el indicador de estado */
@keyframes pulse-glow {
  0%, 100% {
    box-shadow: 0 0 5px #10b98144, 0 0 10px #10b98122;
  }
  50% {
    box-shadow: 0 0 10px #10b98166, 0 0 20px #10b98144;
  }
}

#audit-stream-status {
  animation: pulse-glow 2s ease-in-out infinite;
}

/* Contenedor de logs: los nuevos se añaden abajo y el scroll empieza desde arriba */
#audit-log-stream {
  display: flex;
  flex-direction: column;
  justify-content: flex-start; /* Los logs empiezan desde arriba */
}

/* Mensaje vacío centrado */
#audit-log-empty {
  margin: auto; /* Centra vertical y horizontalmente cuando está vacío */
}

/* Animación de carga de consola */
@keyframes console-loading {
  0% { opacity: 0.5; }
  50% { opacity: 1; }
  100% { opacity: 0.5; }
}

.console-loading {
  animation: console-loading 1.5s ease-in-out infinite;
}

/* Animaciones para notificaciones toast */
@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(100px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes slideOutRight {
  from {
    opacity: 1;
    transform: translateX(0);
  }
  to {
    opacity: 0;
    transform: translateX(100px);
  }
}

/* Efecto de focus en el buscador */
#audit-search:focus {
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  transform: scale(1.01);
  transition: all 0.2s ease;
}

/* Efecto ripple al hacer clic */
@keyframes ripple {
  0% {
    transform: scale(0);
    opacity: 1;
  }
  100% {
    transform: scale(20);
    opacity: 0;
  }
}

/* Transiciones suaves para modo oscuro */
* {
  transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
}

/* ============================================================
   FLEXBOX PARA ALINEACIÓN DE BLOQUES (Live Audit Trail + IA)
   ============================================================ */

/* Contenedor padre - grid con flex para igualar alturas */
.grid.grid-cols-12.gap-6.mt-8 {
  display: flex !important;
  flex-wrap: nowrap;
  align-items: stretch;
  gap: 1.5rem;
}

/* Columna izquierda (Live Audit Trail) */
.col-span-12.lg\:col-span-8 {
  flex: 0 0 66.666667%;
  max-width: 66.666667%;
  display: flex;
  flex-direction: column;
}

/* Columna derecha (Bloque IA) */
.col-span-12.lg\:col-span-4 {
  flex: 0 0 33.333333%;
  max-width: 33.333333%;
  display: flex;
  flex-direction: column;
  padding-right: 2rem;
}

/* Ambos bloques internos ocupan 100% de altura */
.col-span-12.lg\:col-span-8 > div,
.col-span-12.lg\:col-span-4 > article {
  height: 100%;
  display: flex;
  flex-direction: column;
}

/* Asegurar que el panel IA se alinee correctamente */
.col-span-12.lg\:col-span-4 {
  display: flex;
}

/* Responsive: en móviles mantener comportamiento de grid */
@media (max-width: 1023px) {
  .grid.grid-cols-12.gap-6.mt-8 {
    display: grid !important;
    flex-wrap: wrap;
  }
  
  .col-span-12.lg\:col-span-4 {
    flex: none;
    max-width: 100%;
  }
}

/* ============================================================
   RESPONSIVE DESIGN - MOBILE FIRST
   ============================================================ */

/* Mobile (hasta 640px) */
@media (max-width: 640px) {
  /* Espaciado general */
  .w-full.space-y-8 {
    padding: 0 0.5rem;
  }

  .w-full.space-y-8 > * + * {
    margin-top: 1rem !important;
  }

  /* Tarjeta superior más compacta */
  section.rounded-lg {
    border-radius: 0.5rem;
  }

  section.rounded-lg .p-2 {
    padding: 0.75rem;
  }

  /* Buscador y controles */
  .flex.flex-wrap.items-center.gap-2 {
    gap: 0.5rem;
  }

  #audit-search {
    height: 40px;
    font-size: 14px;
  }

  /* Filtros activos más compactos */
  #audit-active-filters {
    gap: 0.5rem;
    font-size: 0.75rem;
  }

  /* Terminal más compacta pero usable */
  .rounded-xl.border.border-gray-300 {
    height: 450px !important;
    border-radius: 0.75rem;
  }

  /* Padding del terminal */
  .px-4.py-3 {
    padding: 0.75rem !important;
  }

  /* Log entries más compactas */
  .log-entry {
    font-size: 0.7rem;
    padding: 0.4rem;
    line-height: 1.4;
  }

  .user-highlight {
    font-size: 0.65rem;
    padding: 2px 6px;
  }

  /* Bloque IA compacto */
  .ia-recommendation {
    margin-top: 1rem;
    padding: 1rem;
  }

  .ia-recommendation__body {
    height: 450px !important; /* Altura ajustada para móvil */
  }

  .ia-recommendation__title {
    font-size: 0.95rem;
    line-height: 1.3;
  }

  .ia-recommendation__message {
    font-size: 0.8rem;
    line-height: 1.5;
  }

  .ia-recommendation__meta {
    gap: 0.5rem;
    font-size: 0.7rem;
  }

  .ia-recommendation__solution-text {
    font-size: 0.8rem;
  }

  /* Navegación IA */
  .nav-button {
    width: 36px;
    height: 36px;
  }

  /* Grid principal */
  .grid.grid-cols-12.gap-6 {
    gap: 1rem;
  }
}

/* Tablet (641px - 1023px) */
@media (min-width: 641px) and (max-width: 1023px) {
  /* Espaciado mejorado */
  .w-full.space-y-8 {
    padding: 0 1rem;
  }

  /* Grid de controles optimizado */
  .flex.flex-wrap.items-center.gap-2 {
    gap: 0.5rem;
  }

  /* Terminal altura media */
  .rounded-xl.border.border-gray-300,
  .rounded-lg.sm\:rounded-xl {
    height: 520px !important;
  }

  /* Stats visibles pero compactas */
  #audit-quick-stats {
    gap: 0.75rem;
  }

  /* Bloque IA */
  .ia-recommendation {
    padding: 1.25rem;
  }

  .ia-recommendation__body {
    height: 520px !important; /* Altura ajustada para tablet */
  }

  .ia-recommendation__title {
    font-size: 1.05rem;
  }

  .ia-recommendation__message {
    font-size: 0.9rem;
  }

  /* Footer compacto */
  .flex.gap-6.font-mono {
    gap: 1rem;
  }

  /* Grid principal */
  .grid.grid-cols-12.gap-6,
  .grid.grid-cols-1.lg\:grid-cols-12 {
    gap: 1.25rem;
  }
}

/* Desktop pequeño (1024px - 1279px) */
@media (min-width: 1024px) and (max-width: 1279px) {
  /* Ajustar padding */
  .col-span-12.lg\:col-span-4 {
    padding-right: 0;
  }

  /* Terminal altura estándar */
  .rounded-xl.border.border-gray-300 {
    height: 550px !important;
  }

  /* Texto más compacto */
  .ia-recommendation__title {
    font-size: 1.1rem;
  }
}

/* Desktop grande (1280px+) */
@media (min-width: 1280px) {
  /* Aprovechar espacio extra */
  .w-full.space-y-8 {
    max-width: 1600px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  /* Terminal más alta */
  .rounded-xl.border.border-gray-300,
  .rounded-lg.sm\:rounded-xl {
    height: 680px !important;
  }

  /* Texto más legible */
  .log-entry {
    font-size: 0.875rem;
    line-height: 1.6;
  }

  /* IA más espaciosa */
  .ia-recommendation {
    padding: 2rem;
  }

  .ia-recommendation__body {
    height: 680px !important; /* Altura igual al terminal */
  }

  .ia-recommendation__title {
    font-size: 1.25rem;
  }
}

/* Extra pequeño (hasta 375px) */
@media (max-width: 375px) {
  /* Ajustes para móviles pequeños */
  .w-full.space-y-8 {
    padding: 0 0.25rem;
  }

  /* Terminal compacta */
  .rounded-lg.sm\:rounded-xl {
    height: 380px !important;
  }

  /* Texto más pequeño */
  .log-entry {
    font-size: 0.65rem;
    padding: 0.3rem;
  }

  .user-highlight {
    font-size: 0.6rem;
    padding: 1px 4px;
  }

  /* Botones más compactos */
  button {
    font-size: 0.75rem;
    padding: 0.4rem 0.75rem;
  }

  /* IA compacta */
  .ia-recommendation {
    padding: 0.75rem;
  }

  .ia-recommendation__body {
    height: 380px !important; /* Altura ajustada para pantallas muy pequeñas */
  }

  .ia-recommendation__title {
    font-size: 0.85rem;
  }

  .ia-recommendation__message {
    font-size: 0.75rem;
  }
}

/* Landscape móvil */
@media (max-width: 896px) and (orientation: landscape) {
  .rounded-xl.border.border-gray-300 {
    height: 350px !important;
  }

  .ia-recommendation {
    margin-top: 0.5rem;
  }
}

/* Touch-friendly - áreas táctiles más grandes */
@media (pointer: coarse) {
  button {
    min-height: 44px;
    padding: 0.5rem 1rem;
  }

  .nav-button {
    min-width: 44px;
    min-height: 44px;
  }
}

/* Print styles */
@media print {
  .flex.flex-wrap.items-center.gap-2,
  #audit-stream-status,
  .ia-recommendation__navigation {
    display: none !important;
  }

  .rounded-xl.border.border-gray-300 {
    height: auto !important;
    border: 1px solid #000;
  }

  #audit-log-stream {
    overflow: visible !important;
  }
}
</style>

<div class="w-full space-y-8 font-sans text-neutral-800 dark:text-[#EAEAEA]">

  <!-- TARJETA SUPERIOR: BUSCADOR COMPACTO -->
  <section class="rounded-lg border border-gray-300 dark:border-neutral-700 bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)] shadow-soft backdrop-blur">
    <div class="p-2 space-y-2">

      <!-- BUSCADOR Y BOTONES RESPONSIVOS -->
      <div class="flex flex-wrap items-center gap-2">
        <div class="relative flex-grow min-w-[200px] w-full sm:w-auto">
          <span class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-neutral-400 dark:text-white/40 text-sm sm:hidden">search</span>
          <input
            id="audit-search"
            type="text"
            placeholder="usuario:nombre rut:12345678-9 tipo_evento:ventas"
            class="w-full bg-neutral-50 dark:bg-neutral-800 border border-gray-300 dark:border-neutral-700 rounded-md h-10 sm:h-8 pl-8 sm:pl-3 pr-3 text-sm sm:text-xs text-neutral-900 dark:text-white placeholder-neutral-400 dark:placeholder-white/40 focus:border-primary/50 focus:outline-none transition-colors"
          />
        </div>
        
        <button id="audit-exec-query" class="flex items-center justify-center gap-1 rounded-md bg-primary px-4 sm:px-3 py-2 sm:py-1.5 text-sm sm:text-xs text-white shadow hover:bg-primary/90 transition-colors w-full sm:w-auto">
          <span class="material-symbols-outlined text-base sm:text-sm">play_arrow</span>
          <span class="font-medium">Buscar</span>
        </button>
        
        <div class="flex gap-2 w-full sm:w-auto">
          <button id="audit-filter-user" class="inline-flex items-center justify-center gap-1 px-3 sm:px-2.5 py-2 sm:py-1.5 rounded-md border border-blue-300 dark:border-blue-500/30 bg-blue-50 dark:bg-blue-500/10 text-blue-700 dark:text-blue-400 hover:bg-blue-100 dark:hover:bg-blue-500/20 transition-colors text-sm sm:text-xs flex-1 sm:flex-initial">
            <span class="material-symbols-outlined text-base sm:text-sm">person</span> 
            <span id="current-user-display" class="hidden sm:inline">Mi usuario</span>
            <span class="sm:hidden">Usuario</span>
          </button>
          
          <button id="audit-active-users" class="inline-flex items-center justify-center gap-1 px-3 sm:px-2.5 py-2 sm:py-1.5 rounded-md border border-green-300 dark:border-green-500/30 bg-green-50 dark:bg-green-500/10 text-green-700 dark:text-green-400 hover:bg-green-100 dark:hover:bg-green-500/20 transition-colors text-sm sm:text-xs flex-1 sm:flex-initial">
            <span class="material-symbols-outlined text-base sm:text-sm">group</span> 
            <span id="active-user-count" class="font-semibold">0</span>
            <span class="hidden sm:inline">Activos</span>
          </button>
        </div>
        
        <div class="flex gap-2 w-full sm:w-auto">
          <button id="audit-export-csv" class="inline-flex items-center justify-center gap-1 px-3 sm:px-2.5 py-2 sm:py-1.5 rounded-md border border-gray-300 dark:border-neutral-700 bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-white hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors text-sm sm:text-xs flex-1 sm:flex-initial" title="Exportar CSV">
            <span class="material-symbols-outlined text-base sm:text-sm">file_download</span>
            <span class="sm:hidden">CSV</span>
          </button>
          
          <button id="audit-export-pdf" class="inline-flex items-center justify-center gap-1 px-3 sm:px-2.5 py-2 sm:py-1.5 rounded-md border border-gray-300 dark:border-neutral-700 bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-white hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors text-sm sm:text-xs flex-1 sm:flex-initial" title="Exportar PDF">
            <span class="material-symbols-outlined text-base sm:text-sm">picture_as_pdf</span>
            <span class="sm:hidden">PDF</span>
          </button>
          
          <button id="audit-export-zip" class="inline-flex items-center justify-center gap-1 px-3 sm:px-2.5 py-2 sm:py-1.5 rounded-md border border-gray-300 dark:border-neutral-700 bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-white hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors text-sm sm:text-xs flex-1 sm:flex-initial" title="Exportar ZIP">
            <span class="material-symbols-outlined text-base sm:text-sm">archive</span>
            <span class="sm:hidden">ZIP</span>
          </button>
        </div>
        
        <button id="audit-clear-filters" class="text-neutral-500 dark:text-white/40 hover:text-neutral-900 dark:hover:text-white text-xs sm:text-xs uppercase tracking-wide w-full sm:w-auto sm:ml-auto py-2 sm:py-0 border sm:border-0 border-neutral-300 dark:border-neutral-700 rounded-md sm:rounded-none">
          Limpiar filtros
        </button>
      </div>

      <!-- FILTROS ACTIVOS -->
      <div id="audit-active-filters" class="flex flex-wrap gap-1 min-h-0"></div>

    </div>
  </section>

  <!-- GRID PRINCIPAL RESPONSIVO: TERMINAL IZQUIERDA | IA DERECHA -->
  <section class="grid grid-cols-1 lg:grid-cols-12 gap-4 sm:gap-6 mt-6 sm:mt-8">

    <!-- TERMINAL + LIVE AUDIT TRAIL -->
    <div class="col-span-1 lg:col-span-8 space-y-4 sm:space-y-6">

      <!-- LIVE AUDIT TRAIL -->
      <div class="rounded-lg sm:rounded-xl border border-gray-300 dark:border-neutral-700 bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)] shadow-xl h-[450px] sm:h-[550px] lg:h-[630px] flex flex-col">

        <!-- HEADER RESPONSIVO -->
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between border-b border-gray-300 dark:border-neutral-700 px-3 sm:px-5 py-3 bg-gradient-to-r from-neutral-50 dark:from-white/5 to-transparent gap-3 sm:gap-0">
          <div class="w-full sm:w-auto">
            <div class="flex items-center gap-2">
              <span class="material-symbols-outlined text-primary text-lg sm:text-xl">terminal</span>
              <p class="uppercase tracking-wider text-neutral-600 dark:text-white/70 text-xs font-semibold">
                Live Audit Trail
              </p>
            </div>
            <p class="text-xs text-neutral-500 dark:text-white/50 mt-0.5">
              Monitoreo en tiempo real · Sistema de eventos
            </p>
          </div>

          <div class="flex items-center gap-3 w-full sm:w-auto justify-between sm:justify-end">
            <!-- Stats rápidas -->
            <div id="audit-quick-stats" class="hidden sm:flex md:flex items-center gap-2 lg:gap-4 text-xs mr-0 lg:mr-4">
              <div class="flex items-center gap-1.5">
                <span class="text-green-400">●</span>
                <span class="text-neutral-600 dark:text-white/60 hidden lg:inline">INFO:</span>
                <span id="stat-info" class="text-neutral-900 dark:text-white font-semibold">0</span>
              </div>
              <div class="flex items-center gap-1.5">
                <span class="text-yellow-400">●</span>
                <span class="text-neutral-600 dark:text-white/60 hidden lg:inline">WARN:</span>
                <span id="stat-warn" class="text-neutral-900 dark:text-white font-semibold">0</span>
              </div>
              <div class="flex items-center gap-1.5">
                <span class="text-red-400">●</span>
                <span class="text-neutral-600 dark:text-white/60 hidden lg:inline">CRIT:</span>
                <span id="stat-crit" class="text-neutral-900 dark:text-white font-semibold">0</span>
              </div>
            </div>
            
            <div class="flex items-center gap-2 bg-neutral-100 dark:bg-neutral-800 rounded-full px-2 sm:px-3 py-1.5">
              <div id="audit-stream-status" class="w-2 h-2 rounded-full bg-green-500 animate-pulse shadow-lg shadow-green-500/50"></div>
              <span id="audit-last-updated" class="text-xs text-neutral-600 dark:text-white/60 font-medium">
                <span class="hidden sm:inline">Sincronizando...</span>
                <span class="sm:hidden">Sync...</span>
              </span>
            </div>
          </div>
        </div>

        <!-- TERMINAL - CONSOLA DE LOGS RESPONSIVA -->
        <div class="px-3 sm:px-4 py-2 sm:py-3 bg-gradient-to-b from-neutral-100 to-neutral-50 dark:from-[#0f1014] dark:to-[#1a1b23] flex-1 overflow-hidden">
          <div id="audit-log-stream" class="h-full overflow-y-auto rounded-md sm:rounded-lg border p-2 sm:p-3
            bg-[var(--card-bg-light)] dark:bg-[var(--card-bg-dark)]
            border-gray-300 dark:border-neutral-700
            scrollbar-thin scrollbar-thumb-slate-400 dark:scrollbar-thumb-primary/40
          ">

            <div id="audit-log-empty" class="
              flex flex-col items-center justify-center h-full
              text-neutral-400 dark:text-white/30
            ">
              <span class="material-symbols-outlined text-4xl sm:text-5xl opacity-50 mb-2">hourglass_empty</span>
              <p class="text-xs sm:text-sm text-center px-4">Esperando eventos del sistema...</p>
            </div>
          </div>
        </div>

        <!-- FOOTER RESPONSIVO - MÉTRICAS DEL SISTEMA -->
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between border-t border-gray-300 dark:border-neutral-700 px-3 sm:px-5 py-2.5 text-xs
                    bg-gradient-to-r from-transparent to-neutral-50 dark:to-white/5 text-neutral-600 dark:text-white/50 gap-2 sm:gap-0">
          <div class="flex gap-3 sm:gap-6 font-mono flex-wrap">
            <div class="flex items-center gap-1.5">
              <span class="material-symbols-outlined text-sm">memory</span>
              <span class="hidden sm:inline">MEM:</span>
              <span id="audit-mem-usage" class="text-blue-600 dark:text-blue-400 font-semibold">--</span>
            </div>
            <div class="flex items-center gap-1.5">
              <span class="material-symbols-outlined text-sm">speed</span>
              <span class="hidden sm:inline">CPU:</span>
              <span id="audit-cpu-usage" class="text-green-600 dark:text-green-400 font-semibold">--</span>
            </div>
            <div class="flex items-center gap-1.5">
              <span class="material-symbols-outlined text-sm">network_ping</span>
              <span class="hidden sm:inline">LATENCY:</span>
              <span id="audit-latency" class="text-yellow-600 dark:text-yellow-400 font-semibold">--</span>
            </div>
          </div>

          <button id="audit-export-csv-footer" 
                  class="flex items-center gap-1.5 hover:text-neutral-900 dark:hover:text-white hover:bg-neutral-200 dark:hover:bg-neutral-700 px-3 py-1.5 rounded-md transition-all w-full sm:w-auto justify-center sm:justify-start">
            <span class="material-symbols-outlined text-sm">download</span>
            <span>Exportar logs</span>
          </button>
        </div>

      </div>

    </div>

    <!-- BLOQUE IA RESPONSIVO -->
    <div class="col-span-1 lg:col-span-4 flex">
      <article
        id="ai-recomendacion-auditoria"
        class="ia-recommendation w-full"
        data-ia-card
        data-severity="info"
        data-ia-status="idle"
        aria-live="polite"
        aria-busy="false"
      >
        <div class="ia-recommendation__halo" aria-hidden="true"></div>

        <div class="ia-recommendation__body h-full">
          
          <div class="ia-recommendation__content">
            <!-- Header con badge ML -->
            <div class="ia-recommendation__meta">
              <span class="material-symbols-outlined text-base sm:text-lg" data-ia-icon>auto_awesome</span>
              <span data-ia-severity class="text-xs sm:text-sm">Analizando entorno</span>
              <span class="ml-badge text-xs" data-ml-badge style="display: none;">ML</span>
            </div>

            <!-- Módulo afectado -->
            <div class="ia-recommendation__module" data-ia-module style="display: none;">
              <span class="material-symbols-outlined text-sm sm:text-base" data-module-icon>dashboard</span>
              <span data-module-name class="text-xs sm:text-sm">Dashboard</span>
            </div>

            <!-- Título del problema -->
            <h4 class="ia-recommendation__title text-base sm:text-lg lg:text-xl" data-ia-title>Sincronizando contexto operacional…</h4>

            <!-- Descripción del problema -->
            <p class="ia-recommendation__message text-sm sm:text-base" data-ia-message>
              El motor IA correlaciona accesos, alertas y sensores para priorizar incidentes de alto impacto en el inventario.
            </p>

            <!-- Severidad del hallazgo -->
            <div class="ia-recommendation__severity-detail" data-severity-detail style="display: none;">
              <span class="ia-recommendation__label text-xs sm:text-sm">Nivel de criticidad</span>
              <div class="severity-indicator" data-severity-indicator>
                <span class="severity-bar" data-severity-bar></span>
                <span class="severity-text text-xs sm:text-sm" data-severity-text>Baja</span>
              </div>
            </div>

            <!-- Plan de acción sugerido -->
            <div class="ia-recommendation__solution">
              <span class="ia-recommendation__label text-xs sm:text-sm">Plan de acción sugerido</span>
              <p class="ia-recommendation__solution-text text-sm sm:text-base" data-ia-solution>
                Se generará una acción sugerida al confirmarse patrones anómalos.
              </p>
            </div>
          </div>

          <!-- Navegación entre hallazgos (sin carrusel anidado) -->
          <div class="ia-recommendation__navigation" data-ml-navigation style="display: none;">
            <button class="nav-button nav-button--prev" data-nav-prev aria-label="Hallazgo anterior">
              <span class="material-symbols-outlined">chevron_left</span>
            </button>
            <span class="nav-counter text-xs sm:text-sm" data-nav-counter>
              <span data-nav-current>1</span> / <span data-nav-total>6</span>
            </span>
            <button class="nav-button nav-button--next" data-nav-next aria-label="Siguiente hallazgo">
              <span class="material-symbols-outlined">chevron_right</span>
            </button>
          </div>

        </div>
      </article>
    </div>

  </section>
</div>

{% endblock %}
